import sys
import logging

from matching.cpe_matcher import CPEMatcher

logging.basicConfig(level=logging.INFO, format="%(message)s")
# logging.getLogger('sqlalchemy.engine').setLevel(logging.INFO)

def main():
    if len(sys.argv) != 4:
        logging.error("Usage: python %s <vendor> <product> <version>" % sys.argv[0])
        logging.info("Example: python %s 'Microsoft Corporation' 'Microsoft .NET Framework 4.5.2' '4.5.51209'" %
                     sys.argv[0])
        exit(1)

    software = {
        'vendor': sys.argv[1],          # Example: 'Microsoft Corporation'
        'product': sys.argv[2],         # Example: 'Microsoft .NET Framework 4.5.2'
        'version': sys.argv[3]          # Example: '4.5.51209'
    }

    cpe_matcher = CPEMatcher()
    cpe_candidates = cpe_matcher.search_cpes_for_software(software)
    logging.info("Found %d CPEs:" % len(cpe_candidates))

    for cpe_candidate in cpe_candidates:
        logging.info(cpe_candidate['uri_binding'])

if __name__ == '__main__':
    main()
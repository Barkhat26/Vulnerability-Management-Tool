from models import *
import logging
from sqlalchemy import Table, Column, Integer, String, MetaData
import sys



def init_db():
    drop_db()

    Model.metadata.bind = engine
    Model.metadata.create_all(bind=engine)

def drop_db():
    if engine.has_table(CPE.__tablename__):
        CPE.__table__.drop()
    if engine.has_table(WFN.__tablename__):
        WFN.__table__.drop()
    if engine.has_table(CPEEntry.__tablename__):
        CPEEntry.__table__.drop()
    if engine.has_table(Reference.__tablename__):
        Reference.__table__.drop()
    if engine.has_table(CVE.__tablename__):
        CVE.__table__.drop()
    if engine.has_table(Impact.__tablename__):
        Impact.__table__.drop()
    if engine.has_table(Access.__tablename__):
        Access.__table__.drop()

def clean_db():
    CPE.query.delete()
    WFN.query.delete()
    CPEEntry.query.delete()
    Reference.query.delete()
    CVE.query.delete()
    Access.query.delete()
    Impact.query.delete()
    logging.info('All tables has been cleaned')

if __name__ == '__main__':
    if sys.argv[1] == 'init':
        init_db()
    elif sys.argv[1] == 'clean':
        clean_db()
    else:
        logging.error('Unknown command')
